# Задание 3

## Требуется
1. Описать схему API для Сервера-посредника для взаимодействия с Клиентами.
2. Описать
   * Общую схему работы Сервера-посредника
   * Взаимодействие с Источниками и Клиентами 
   * Составить примерный список необходимых для реализации инструментов и библиотек.


## Вопросы, которые бы я задал бизнес-аналитику
1. Почему два важных действия(Parser/API) делает один сервис?  
Я бы разделил на два, т.к. логика парсера выглядит достаточно нагруженной.   
Думаю, я бы не хотел делать монолитное приложение в данном случае.
2. Наверное, в ответах от API "Источника 1" и "Источника 2" должны быть даты последнего изменения?
   1. Иначе не совсем понятно в каких случаях нам нужно обновлять данные в БД, а в каких нет.
3. В каком формате из источников приходят данные?


## Решение

### 2.1 Описание общей схемы работы Сервера-посредника
В моем понимание должно быть два независимых сервиса. Один из них парсит данные с источников, другой является просто API  
!['page_1'](ServicesSchema.png)

1. Первый шаг выполняет сервис-парсер. Он загружает данные с источников
2. INSERT/UPDATE данных в БД
3. Далее, при запросе данных клиентом, происходит шаг 4 и 5. API-сервис обращается в Cache/DB, при необходимости 
модифицирует/объединяет данные и возвращает их 
4. Обращение к Cache
5. Обращение к БД

### 2.2 Взаимодействие с Источниками и Клиентами
#### С источниками
Предполагаю, что источники должны возвращать, дату последнего изменения данных.  
1. В таком случае сервис-парсер выступает в роли CronJob-а и обращается к источникам каждую минуту или час или любое 
другое более подходящее время и сравнивает сохраненную сервисом дату с датой из источника.
2. В случае, изменения даты из источника, требуется приступить к изменению данных в БД. 
3. Изменение данных в БД. В моем понимание есть несколько путей работы с БД, в случае, периодических вставок данных:
   1. TRUNCATE TABLE, после чего вставляем заново все данные и так, каждый раз.  
   (Подходит, когда данные из источника, каждый раз сильно отличаются от сохраненных данных или 
   когда данных не очень много)
   2. Последовательная сверка данных и изменение, в случае, их отличия  
      (Подходит, когда данные не сильно отличаются)


## Схема БД
!['page_2'](DataBase.drawio.png)